#include <iostream>      // Подключение библиотеки для ввода/вывода (cout, cin)
#include <iomanip>       // Подключение библиотеки для форматирования вывода (setprecision, fixed)
#include <cmath>
using namespace std;     // Позволяет использовать элементы std без приставки std::

// ФУНКЦИЯ: Ввод данных с клавиатуры,void (ничего не возвращает)
void inputData(float* p, int n) {//float* p: указатель на массив чисел с плавающей точкой,n-количество элементов для ввода
    cout << "Введите значения: ";  // Выводит приглашение для ввода
    
    // Цикл для ввода n значений
    for (int i = 0; i < n; i++) {
        cin >> *(p + i);  // Считывает значение и сохраняет по адресу (p + i),сдвигаем указатель, изначально указатель в 0
                          // Это эквивалентно: p[i]
    }
}
// ФУНКЦИЯ: Вычисление среднего арифметического значения
float average(const float* p, int n) {//const float* p: указатель на константный массив (не изменяется)
    float sum = 0.0;     // Переменная для накопления суммы, инициализация нулём,Число с плавающей точкой,явное обозначениие типа float
    
    // Цикл для суммирования всех элементов массива
    for (int i = 0; i < n; i++) {
        sum += *(p + i);  // Добавляет к сумме значение элемента (разыменовывание указателя)
    }
    
    return sum / n;       // Возвращает среднее: сумма всех элементов / количество элементов
}
// ФУНКЦИЯ: Поиск минимального значения в массиве
float minValue(const float* p, int n) { // const float* p: указатель на константный массив,
    float minVal =pow(10,10);     
    for (int i = 0; i < n; i++) {
        if (*(p + i) < minVal) {
            minVal = *(p + i);
        }
    }   
    return minVal;
}
// ФУНКЦИЯ: Поиск максимального значения в массиве
float maxValue(const float* p, int n) {
    float maxVal = -10;     
    for (int i = 0; i < n; i++) {
        if (*(p + i) > maxVal) {
            maxVal = *(p + i); 
        }
    }
    return maxVal;       
}

// ФУНКЦИЯ: Фильтрация значений, превышающих среднее арифметическое
//   - int& newCount: ссылка на переменную для сохранения количества отфильтрованных элементов
//                    (передаётся по ссылке, чтобы функция могла изменить значение)
float* filterAboveAverage(float* p, int n, int& newCount) {
    float avg = average(p, n);  // Вычисляем среднее значение исходного массива
    newCount = 0;  // Инициализируем счётчик нулём
    for (int i = 0; i < n; i++) {// Первый проход: подсчитываем количество элементов выше среднего
        // Если элемент больше среднего, увеличиваем счётчик
        if (*(p + i) > avg) {
            newCount++;
        }
    }
    // Создаём новый динамический массив размером newCount
    float* filteredArray = new float[newCount];
    
    // Второй проход: заполняем новый массив значениями выше среднего
    int index = 0;  // Индекс для заполнения нового массива (начиная с 0)
    for (int i = 0; i < n; i++) {
        // Если элемент больше среднего, добавляем его в новый массив
        if (*(p + i) > avg) {
            *(filteredArray + index) = *(p + i);  // Копируем значение
            index++;                               // Переходим на следующую позицию
        }
    }
    
    return filteredArray;  // Возвращаем указатель на новый массив с отфильтрованными значениями
}
// ГЛАВНАЯ ФУНКЦИЯ ПРОГРАММЫ     Возвращаемое значение: int (код завершения программы: 0 - успешно, 1 - ошибка)
int main() {
    // Устанавливает кодировку Windows консоли на UTF-8 (для корректного отображения русских букв)
    #ifdef _WIN32    
        system("chcp 65001 > nul"); 
    #endif
    cout << "=== Анализ сенсора ===" << endl;  //cout-вывод,endl-перенос на новую строчку
    int n;  // Переменная для хранения количества измерений
    cout << "Введите количество измерений: ";  
    cin >> n;  // Считывание количества измерений с клавиатуры
    
    // Проверка корректности ввода
    if (n <= 0) {
        // Если количество измерений не положительное, выводим ошибку
        cout << "Ошибка: количество измерений должно быть положительным!" << endl;
        return 1;  // Завершаем программу с кодом ошибки (1)
    }
    
    // Динамическое выделение памяти для массива из n элементов типа float
    float* data = new float[n];//new-выделение памяти,float[n]-массив из n элементов типа float,data-указатель(ссылка на 1 элемент),* -делаем указатель на float[n]
    
    inputData(data, n);  // Вызываем функцию для ввода значений в массив
    
    // ВЫЧИСЛЕНИЕ СТАТИСТИКИ
    float avg = average(data, n);      // Вычисляем среднее значение
    float minVal = minValue(data, n);  // Вычисляем минимальное значение
    float maxVal = maxValue(data, n);  // Вычисляем максимальное значение
    cout << fixed << setprecision(1);  // формат вывода количества знаков после запятой
    cout << "Среднее значение: " << avg << endl;  // Выводим среднее значение
    cout << "Минимум: " << minVal << endl;        // Выводим минимальное значение
    cout << "Максимум: " << maxVal << endl;       // Выводим максимальное значение
    int filteredCount;  // Переменная для хранения количества отфильтрованных элементов
    // Вызываем функцию фильтрации (передаём по ссылке &filteredCount для получения количества)
    float* filteredData = filterAboveAverage(data, n, filteredCount);
    cout << "Значения выше среднего:" << endl;  // Заголовок для отфильтрованных значений    
    // Цикл для вывода всех элементов отфильтрованного массива
    for (int i = 0; i < filteredCount; i++) {
        cout << *(filteredData + i) << " ";  // Выводим каждый элемент с пробелом
    }
    cout << endl;  // Переносим курсор на новую строку
    delete[] data;         // Освобождаем память, выделенную для исходного массива,если без [] удаляется только первая ячейка
    delete[] filteredData; // Освобождаем память, выделенную для отфильтрованного массива,если без [] удаляется только первая ячейка
    return 0; 
}
