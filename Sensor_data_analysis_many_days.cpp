#include <iostream>      // Подключение библиотеки для ввода/вывода (cout, cin)
#include <iomanip>       // Подключение библиотеки для форматирования вывода (fixed, setprecision)

using namespace std;     // Позволяет использовать элементы std без приставки std::

// ============================================================================
// ФУНКЦИЯ: Вычисление средней температуры за один день
// Параметры:
//   - float* row: указатель на массив температур за день
//   - int h: количество измерений в день (часов)
// Возвращаемое значение: float (средняя температура за день)
// ============================================================================
float dayAverage(float* row, int h) {
    float sum = 0.0;     // Переменная для накопления суммы температур
    
    // Цикл для суммирования всех температур дня
    for (int i = 0; i < h; i++) {
        sum += *(row + i);  // Добавляем каждое измерение (разыменовываем указатель)
    }
    
    return sum / h;       // Возвращаем среднее: сумма / количество измерений
}

// ============================================================================
// ФУНКЦИЯ: Вычисление общей средней температуры за все дни
// Параметры:
//   - float** p: указатель на массив указателей (двумерный массив)
//   - int d: количество дней
//   - int h: количество измерений в каждом дне
// Возвращаемое значение: float (общая средняя температура)
// Примечание: это ДВУМЕРНЫЙ массив!
// ============================================================================
float overallAverage(float** p, int d, int h) {
    float totalSum = 0.0;  // Переменная для накопления ВСЕХ температур
    
    // Внешний цикл: перебираем каждый день
    for (int i = 0; i < d; i++) {
        // Внутренний цикл: перебираем каждое измерение в дне
        for (int j = 0; j < h; j++) {
            // *(*(p + i) + j) означает:
            // (p + i) — указатель на i-й день
            // *(p + i) — массив температур i-го дня
            // *(p + i) + j — адрес j-го элемента в i-м дне
            // *(*(p + i) + j) — значение температуры
            totalSum += *(*(p + i) + j);
        }
    }
    
    // Возвращаем общее среднее: сумма всех температур / общее количество измерений
    // Преобразуем в double для точности вычислений
    return double(totalSum) / double(d * h);
}

// ============================================================================
// ФУНКЦИЯ: Вывод дней с температурой выше общей средней
// Параметры:
//   - float** p: указатель на двумерный массив температур
//   - int d: количество дней
//   - int h: количество измерений в день
// Возвращаемое значение: void (ничего не возвращает, только выводит)
// ============================================================================
void showHotDays(float** p, int d, int h) {
    // Вычисляем общую среднюю температуру
    float overallAvg = overallAverage(p, d, h);
    
    cout << "Теплые дни:" << endl;  // Заголовок для результатов
    
    // Цикл для перебора каждого дня
    for (int i = 0; i < d; i++) {
        // Вычисляем среднюю температуру i-го дня
        // *(p + i) — получаем указатель на массив i-го дня
        float dayAvg = dayAverage(*(p + i), h);
        
        // Проверяем, если средняя температура дня больше общей средней
        if (dayAvg > overallAvg) {
            // Выводим день (i+1, потому что дни нумеруются с 1)
            cout << "День " << (i + 1) << " (среднее = " 
                 << fixed << setprecision(1) << dayAvg << ")" << endl;
        }
    }
}

// ============================================================================
// ГЛАВНАЯ ФУНКЦИЯ ПРОГРАММЫ
// ============================================================================
int main() {
    // Устанавливает кодировку Windows консоли на UTF-8
    #ifdef _WIN32        // Проверяет, компилируется ли для Windows
        system("chcp 65001 > nul");  // Команда для изменения кодовой страницы
    #endif
    
    int d, h;  // d - количество дней, h - количество измерений в день
    
    // ========================================================================
    // БЛОК 1: ВВОД РАЗМЕРОВ МАССИВА
    // ========================================================================
    cout << "Введите количество дней: ";
    cin >> d;
    
    cout << "Введите количество измерений в дне: ";
    cin >> h;
    
    // ========================================================================
    // БЛОК 2: ПРОВЕРКА ОГРАНИЧЕНИЙ
    // ========================================================================
    // Проверяем, что значения находятся в допустимых пределах
    if (d <= 0 || d > 30 || h <= 0 || h > 24) {
        cout << "Ошибка: количество дней должно быть 1-30, измерений 1-24!" << endl;
        return 1;  // Завершаем программу с кодом ошибки
    }
    
    // ========================================================================
    // БЛОК 3: СОЗДАНИЕ ДВУМЕРНОГО ДИНАМИЧЕСКОГО МАССИВА
    // ========================================================================
    // ЭТО САМАЯ СЛОЖНАЯ ЧАСТЬ!
    
    // Шаг 1: Выделяем память для массива УКАЗАТЕЛЕЙ
    // float** data — указатель на массив указателей
    // new float*[d] — создаём массив из d указателей на float
    float** data = new float*[d];
    
    // Шаг 2: Для каждого указателя выделяем память для массива температур
    for (int i = 0; i < d; i++) {
        // *(data + i) — это i-й указатель в массиве data
        // new float[h] — выделяем память для h измерений этого дня
        *(data + i) = new float[h];
        // Теперь *(data + i) указывает на массив из h элементов
    }
    
    // Структура в памяти:
    // data → [ptr1][ptr2][ptr3]...[ptrD]  (d указателей)
    //        ↓      ↓      ↓         ↓
    //    [t1][t2].. [t1][t2].. [t1][t2]...  (h температур в каждом дне)
    
    // ========================================================================
    // БЛОК 4: ВВОД ДАННЫХ ТЕМПЕРАТУР
    // ========================================================================
    // Вводим температуры для каждого дня
    for (int i = 0; i < d; i++) {
        cout << "День " << (i + 1) << ": ";  // Выводим номер дня (с 1, а не с 0)
        
        // Вводим температуры для каждого часа этого дня
        for (int j = 0; j < h; j++) {
            // *(data + i) — указатель на массив i-го дня
            // *(*(data + i) + j) — j-е значение в i-м дне
            cin >> *(*(data + i) + j);
        }
    }
    
    // ========================================================================
    // БЛОК 5: ВЫЧИСЛЕНИЕ И ВЫВОД ОБЩЕЙ СРЕДНЕЙ ТЕМПЕРАТУРЫ
    // ========================================================================
    // Вычисляем общую среднюю температуру для всех дней
    double avg = overallAverage(data, d, h);
    
    // Устанавливаем формат вывода: 2 знака после запятой
    cout << fixed << setprecision(2);
    cout << "Общая средняя температура: " << avg << endl;
    
    // ========================================================================
    // БЛОК 6: ВЫВОД ТЕПЛЫХ ДНЕЙ
    // ========================================================================
    // Устанавливаем формат вывода: 1 знак после запятой
    cout << fixed << setprecision(1);
    
    // Вызываем функцию, которая выводит дни выше средней температуры
    showHotDays(data, d, h);
    
    // ========================================================================
    // БЛОК 7: ОСВОБОЖДЕНИЕ ПАМЯТИ
    // ========================================================================
    // ОЧЕНЬ ВАЖНО: освобождаем память в ОБРАТНОМ порядке выделения!
    
    // Шаг 1: Для каждого дня освобождаем массив температур
    for (int i = 0; i < d; i++) {
        // *(data + i) — это указатель на массив i-го дня
        // delete[] освобождает массив (обратите внимание на [])
        delete[] *(data + i);
    }
    
    // Шаг 2: Освобождаем главный массив указателей
    // data — это массив указателей, освобождаем его
    delete[] data;
    
    // Теперь вся память полностью освобождена!
    
    return 0;  // Завершаем программу успешно
}
